import type { FileUIPart } from "ai";
import { type RefObject, type PropsWithChildren, type FormEvent } from "react";

export type AttachmentsContext = {
    files: (FileUIPart & { id: string })[];
    add: (files: File[] | FileList) => void;
    remove: (id: string) => void;
    clear: () => void;
    openFileDialog: () => void;
    fileInputRef: RefObject<HTMLInputElement | null>;
};

export type TextInputContext = {
    value: string;
    setInput: (v: string) => void;
    clear: () => void;
};

export type PromptInputControllerProps = {
    textInput: TextInputContext;
    attachments: AttachmentsContext;
    /** INTERNAL: Allows PromptInput to register its file textInput + "open" callback */
    __registerFileInput: (
        ref: RefObject<HTMLInputElement | null>,
        open: () => void
    ) => void;
};

export type PromptInputProviderProps = PropsWithChildren<{
    initialInput?: string;
}>;

export type PromptInputMessage = {
    text?: string;
    files?: FileUIPart[];
};

export type PromptInputProps = Omit<
    React.HTMLAttributes<HTMLFormElement>,
    "onSubmit" | "onError"
> & {
    accept?: string; // e.g., "image/*" or leave undefined for any
    multiple?: boolean;
    // When true, accepts drops anywhere on document. Default false (opt-in).
    globalDrop?: boolean;
    // Render a hidden input with given name and keep it in sync for native form posts. Default false.
    syncHiddenInput?: boolean;
    // Minimal constraints
    maxFiles?: number;
    maxFileSize?: number; // bytes
    onError?: (err: {
        code: "max_files" | "max_file_size" | "accept";
        message: string;
    }) => void;
    onSubmit: (
        message: PromptInputMessage,
        event: FormEvent<HTMLFormElement>
    ) => void | Promise<void>;
};
